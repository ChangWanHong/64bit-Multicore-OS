# 32비트 보호 모드로 전환하자
리얼 모드에서 보호 모드로 전환하려면 크게 6단계를 거쳐야한다.

| 단계 | 모드 | 설명 |
| :--: | :--: | :--- |
| 1 | 16비트 리얼 모드 | 세그먼트 디스크립터 생성<br/>보호 모드 코드와 데이터용 세그먼트 디스크립터 생성 |
| 2 | 16비트 리얼 모드 | GDT 정보 생성<br/>세그먼트 디스크립터의 시작 어드레스와 디스크립터의 전체 크기 저장 |
| 3 | 16비트 리얼 모드 | 프로세서에 GDT 정보 설정<br/>GDTR 레지스터에 GDT의 시작 어드레스와 크기 설정 |
| 4 | 16비트 리얼 모드 | CR0 컨트롤 레지스터 설정<br/>CR0 컨트롤 레지스터의 PE 비트=1, PG 비트=0 |
| 5 | 16비트 리얼 모드 | jmp 명령으로 CS 세그머늩 셀렉터 변경과 보호 모드로 전환<br/>jmp 0x08: 보호모드 커널의 시작 어드레스 |
| 6 | 32비트 보호 모드 | 각종 세그먼트 셀렉터 및 스택 초기화<br/>DS, ES, FS, GS, SS 세그먼트 셀렉터와 ESP, EBP 레지스터 초기화 |
| 7 | 32비트 보호 모드 | 보호 모드 커널 실행 |

## 세그먼트 디스크립터 생성
세그먼트 디스크립터(Segment Descriptor)는 세그멘테이션 기법(메모리 관리 기법)에서 세그먼트의 정보를 나타내느 ㄴ자료구조이다.
세그먼트는 메모리 공간을 임의의 크기로 나눈 영역을 의미하며, 세그먼트를 복잡하게 구성할수록 세그먼트 디스크립터의 수도 증가한다. MINT64 OS에서는 보호 모드의 기본 기능만 사용하므로 4GB 저체 메모리 공간을 지정하는 커널 코드와 데이터 세그먼트만 사용한다.

세그먼트에 대한 정보를 나타내는 세그먼트 디스크립터는 크게 코드 세그먼트 디스크립터와 데이터 세그먼트 디스크립터로 나누어진다.
코드 세그먼트 디스크립터는 실행 가능한 코드가 포함된 세그먼트에 대한 정보를 나타내며, CS 세그먼트 셀렉터에 사용된다.
데이터 세그먼트 디스크립터는 데이터ㅏㄱ 포함된 세그먼트에 대한 정보를 나타내며, CS 세그먼트 셀렉터를 제외한 나머지 셀렉터에 사용할 수 있다.
스택 영역 또한 데이터를 읽고 쓰는 데이터 영역의 한 종류이므로 데이터 세그먼트 디스크립터를 사용한다.

보호모드의 세그먼트 디스크립터는 8바이트로 아래와 같이 다양한 필드가 있다.

![](https://github.com/HIPERCUBE/64bit-Multicore-OS/blob/master/book/img/Ch6_img1.jpg)

